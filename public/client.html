<!DOCTYPE html>
<html>

<head>
  <title>Cấm Chọn Wuwa</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/bootstrap-icons.min.css">
  <link rel="icon" href="/assets/app.ico">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/login.css">

  <script src="/js/lib/socket.io.min.js"></script>
  <!-- Embed spine-webgl runtime (single canvas, single context) -->
  <!-- <script src="/js/lib/spine-webgl.min.js"></script> -->
  <script src="/js/lib/spine-webgl-4.2.43.min.js"></script>
  <!-- <script src="https://unpkg.com/@esotericsoftware/spine-player@4.2.43/dist/iife/spine-player.min.js"></script> -->
</head>

<body class="bg-light">
  <div id="main-background"></div>


  <!-- Loading Screen -->
  <div id="loading-screen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <!-- <h2 class="loading-title">Cấm-Chọn Wuwa</h2> -->
      <p class="loading-text">Đang tải...</p>
      <div class="loading-progress-bar">
        <div id="loading-progress" class="loading-progress-fill"></div>
      </div>
      <p id="loading-percentage" class="loading-percentage">0%</p>
    </div>
  </div>

  <!-- Ban/Pick Transition Loading (minimal - icon only) -->
  <div id="ban-pick-loading" style="display: none;">
    <div class="loading-content">
      <div class="loading-spinner"></div>
    </div>
  </div>
  <!-- <div id="player" style="width:100%;height:100%;"></div>
  <script>
    new spine.SpinePlayer("player", {
      atlasUrl: "/live2d/Zhezhi.atlas",
      jsonUrl: "/live2d/Zhezhi.json",
      textureUrl: "/live2d/Zhezhi.webp",
      alpha: true,
      premultipliedAlpha: false,
      preserveDrawingBuffer: true,
      fixAtlasScale: true,
      animation: "idle",
      loop: true,
      showControls: false,
      showLoading: false,
      backgroundColor: "#00000000",
      interactive: false,
    });
  </script> -->

  <!-- Login View -->
  <div id="login-view" class="container mt-5" style="max-width: 500px; display: none;"></div>
  <!-- Draft View -->
  <div id="draft-view" class="container mt-3" style="display: none;">
    <!-- Host Controls Offcanvas -->
    <button id="host-controls-toggle"
      class="btn glass-toggle-btn position-fixed top-0 end-0 m-3 rounded-circle d-flex justify-content-center align-items-center d-none"
      type="button" data-bs-toggle="offcanvas" data-bs-target="#host-controls-panel" aria-controls="host-controls-panel"
      style="z-index: 1050;" aria-label="Bảng điều khiển">
      <i class="bi bi-gear-fill fs-5 text-white"></i>
    </button>

    <div class="offcanvas offcanvas-end settings-offcanvas" tabindex="-1" id="host-controls-panel"
      aria-labelledby="host-controls-panel-label" data-bs-backdrop="false" data-bs-scroll="true">
      <div class="offcanvas-header settings-header">
        <div>
          <h5 class="offcanvas-title settings-title mb-0" id="host-controls-panel-label">Bảng điều khiển</h5>
          <p class="settings-subtitle mb-0">Cài đặt và quản lý phòng</p>
        </div>
        <button type="button" class="btn-close settings-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>

      <!-- Tab Navigation -->
      <div class="settings-tabs">
        <button class="settings-tab active" data-tab="tools">
          <i class="bi bi-tools"></i>
          <span>Điều Khiển</span>
        </button>

        <button class="settings-tab" data-tab="utilities">
          <i class="bi bi-magic"></i>
          <span>Công Cụ</span>
        </button>

        <button class="settings-tab" data-tab="settings">
          <i class="bi bi-gear"></i>
          <span>Cài Đặt</span>
        </button>
        <button class="settings-tab" data-tab="info">
          <i class="bi bi-info-circle-fill"></i>
          <span>Thông Tin</span>
        </button>

        <button class="settings-tab" data-tab="exit" id="settings-exit-btn">
          <i class="bi bi-box-arrow-right"></i>
          <span>Thoát</span>
        </button>
      </div>

      <div class="offcanvas-body settings-body">

        <!-- Tab: Thiết Lập Phòng -->
        <div class="settings-tab-content active" data-tab-content="tools">

          <!-- Chọn Người Đi Trước -->
          <div class="tools-card" id="choose-first-card">
            <div class="tools-card-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-people-fill"></i>
                <span>Chọn Người Đi Trước</span>
              </div>
              <button class="btn btn-link text-white p-0 tools-card-toggle">
                <i class="bi bi-chevron-down"></i>
              </button>
            </div>
            <div class="tools-card-body">
              <div id="pre-draft-controls" class="player-selection-group">
                <!-- Nút chọn player đi trước sẽ được tạo động bằng JS -->
              </div>
            </div>
          </div>

          <!-- Điều Khiển Game -->
          <div class="tools-card" id="game-control-card">
            <div class="tools-card-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-controller"></i>
                <span>Điều Khiển Game</span>
              </div>
              <button class="btn btn-link text-white p-0 tools-card-toggle">
                <i class="bi bi-chevron-down"></i>
              </button>
            </div>
            <div class="tools-card-body">
              <button onclick="togglePause()" class="btn tools-btn-primary w-100">
                Tạm Dừng/Tiếp Tục
              </button>
            </div>
          </div>

          <!-- Thời Gian Đếm Ngược -->
          <div class="tools-card" id="countdown-control-card">
            <div class="tools-card-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-clock-fill"></i>
                <span>Thời Gian Đếm Ngược (s)</span>
              </div>
              <button class="btn btn-link text-white p-0 tools-card-toggle">
                <i class="bi bi-chevron-down"></i>
              </button>
            </div>
            <div class="tools-card-body">
              <div class="tools-input-group">
                <input id="countdown-input" type="number" value="30" min="1" class="tools-number-input">
                <div class="tools-input-controls">
                  <button class="tools-input-btn" onclick="document.getElementById('countdown-input').stepUp()">
                    <i class="bi bi-chevron-up"></i>
                  </button>
                  <button class="tools-input-btn" onclick="document.getElementById('countdown-input').stepDown()">
                    <i class="bi bi-chevron-down"></i>
                  </button>
                </div>
                <button onclick="setCountdown()" class="btn tools-btn-apply">
                  Áp Dụng
                </button>
              </div>
            </div>
          </div>

          <!-- Quản Lý Người Chơi -->
          <div class="tools-card" id="player-management-card">
            <div class="tools-card-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-people"></i>
                <span>Quản Lý Người Chơi (kick)</span>
              </div>
              <button class="btn btn-link text-white p-0 tools-card-toggle">
                <i class="bi bi-chevron-down"></i>
              </button>
            </div>
            <div class="tools-card-body">
              <div id="kick-buttons-container" class="player-selection-group">
                <!-- Nút kick sẽ được tạo động bằng JS -->
              </div>
            </div>
          </div>

          <!-- ID Phòng -->
          <!-- <div class="tools-card room-id-card">
            <div class="tools-card-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-door-closed-fill"></i>
                <span>ID Phòng</span>
              </div>
              <button class="btn btn-link text-white p-0 tools-card-toggle">
                <i class="bi bi-chevron-down"></i>
              </button>
            </div>
            <div class="tools-card-body">

            </div>
          </div> -->

          <!-- Quản Lý Phòng -->
          <div class="tools-card" id="room-management-card">
            <div class="tools-card-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-door-open-fill"></i>
                <span>Quản Lý Phòng</span>
              </div>
              <button class="btn btn-link text-white p-0 tools-card-toggle">
                <i class="bi bi-chevron-down"></i>
              </button>
            </div>
            <div class="tools-card-body">
              <span class="sub-title">ID Phòng</span>
              <div class="room-id-display">
                <div class="room-id-value" id="settings-room-id">******</div>
                <div class="room-id-actions">
                  <button class="btn room-id-btn" id="toggle-room-id-visibility" title="Hiện/Ẩn ID">
                    <i class="bi bi-eye-slash-fill"></i>
                  </button>
                  <button class="btn room-id-btn" id="copy-room-id-btn" title="Copy ID">
                    <i class="bi bi-clipboard"></i>
                  </button>
                </div>
              </div>
              <span class="sub-line"></span>
              <button onclick="closeRoom()" class="btn tools-btn-danger w-100">
                <i class="bi bi-trash-fill me-2"></i>Xóa Phòng
              </button>
            </div>
          </div>
        </div>


        <!-- Tab: Công Cụ (New) -->
        <div class="settings-tab-content" data-tab-content="utilities">
          <!-- Đồng Hồ Đếm Ngược -->
          <div class="tools-card" id="utility-timer-card">
            <div class="tools-card-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-alarm-fill"></i>
                <span>Đồng Hồ Đếm Ngược (mm:ss.SS)</span>
              </div>
              <button class="btn btn-link text-white p-0 tools-card-toggle">
                <i class="bi bi-chevron-down"></i>
              </button>
            </div>
            <div class="tools-card-body">
              <div class="utility-timer-container">
                <div class="utility-timer-display" id="utility-timer-display">10:00.00</div>

                <div class="utility-timer-settings">
                  <div class="d-flex align-items-center justify-content-center gap-2 mb-3">
                    <input type="number" id="utility-timer-input-min" class="tools-number-input timer-input" value="10"
                      min="0" placeholder="Phút">
                    <span class="fw-bold">:</span>
                    <input type="number" id="utility-timer-input-sec" class="tools-number-input timer-input" value="00"
                      min="0" max="59" placeholder="Giây">
                    <span class="fw-bold">.</span>
                    <input type="number" id="utility-timer-input-ms" class="tools-number-input timer-input" value="00"
                      min="0" max="99" placeholder="ms">
                  </div>
                </div>

                <div class="utility-timer-actions d-flex gap-2">
                  <button class="btn tools-btn-primary flex-grow-1" id="utility-timer-toggle-btn">
                    <i class="bi bi-play-fill"></i> Bắt Đầu
                  </button>
                  <button class="btn tools-btn-danger" id="utility-timer-reset-btn" title="Đặt lại">
                    <i class="bi bi-arrow-counterclockwise"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Vòng Quay May Mắn -->
          <div class="tools-card collapsed" id="random-wheel-card">
            <div class="tools-card-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-pie-chart-fill"></i>
                <span>Vòng Quay May Mắn</span>
              </div>
              <button class="btn btn-link text-white p-0 tools-card-toggle">
                <i class="bi bi-chevron-down"></i>
              </button>
            </div>
            <div class="tools-card-body d-flex flex-column align-items-center">
              <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <div class="wheel" id="random-wheel">
                  <div class="wheel-segment segment-1">
                    <span class="segment-text" id="wheel-p1-name">P1</span>
                  </div>
                  <div class="wheel-segment segment-2">
                    <span class="segment-text" id="wheel-p2-name">P2</span>
                  </div>
                </div>
                <div class="wheel-center"></div>
              </div>
              <div id="wheel-result" class="mt-3 text-center fw-bold" style="min-height: 1.5rem; color: #fbbf24;">
              </div>
              <button class="btn tools-btn-primary w-100 mt-3" id="spin-wheel-btn">
                <i class="bi bi-arrow-repeat me-2"></i>Quay Ngẫu Nhiên
              </button>
            </div>
          </div>

        </div>


        <!-- Tab: Cài Đặt -->
        <div class="settings-tab-content" data-tab-content="settings">
          <div class="settings-section">
            <div class="settings-section-title">
              <i class="bi bi-volume-up-fill"></i>
              <span>Âm Thanh</span>
            </div>
            <div class="settings-item">
              <div class="settings-item-info">
                <div class="settings-item-label">Thông báo âm thanh khi tới lượt chọn</div>
                <div class="settings-item-desc">Phát âm thanh để nhắc nhở khi đến lượt của bạn</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-sound" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title">
              <i class="bi bi-stars"></i>
              <span>Hiệu Ứng Hình Ảnh</span>
            </div>
            <div class="settings-item">
              <div class="settings-item-info">
                <div class="settings-item-label">Hiển thị Live2D Animation (Beta)</div>
                <div class="settings-item-desc">Bật/tắt hiệu ứng Live2D khi chọn tướng (hợp lệ với nhân vật 5*
                  banner limit, có thể cải thiện hiệu suất)
                </div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-live2d" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title">
              <i class="bi bi-arrows-fullscreen"></i>
              <span>Chế Độ Hiển Thị</span>
            </div>
            <div class="settings-item">
              <div class="settings-item-info">
                <div class="settings-item-label">Tự động fullscreen khi bắt đầu</div>
                <div class="settings-item-desc">Tự động chuyển sang chế độ toàn màn hình khi bắt đầu game (chỉ
                  tác dụng trên host)
                </div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-auto-fullscreen" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title">
              <i class="bi bi-database"></i>
              <span>Dữ liệu</span>
            </div>
            <div class="settings-item">
              <div class="settings-item-info">
                <div class="settings-item-label">Dữ liệu thống kê</div>
                <div class="settings-item-desc">Chia sẻ dữ liệu ban/pick để thống kê và cải thiện tính chính xác</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-enable-stats" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>

        <!-- Tab: Thông Tin -->
        <div class="settings-tab-content" data-tab-content="info">
          <div class="settings-info-card">
            <div class="settings-info-header">
              <i class="bi bi-controller"></i>
              <h6>Cấm Chọn Wuwa</h6>
            </div>
            <div class="settings-info-item">
              <span class="settings-info-label">Phiên bản</span>
              <span class="settings-info-value">1.2.1</span>
            </div>
            <div class="settings-info-item">
              <span class="settings-info-label">Nhà phát triển</span>
              <span class="settings-info-value">KDONE</span>
            </div>
            <div class="settings-info-item">
              <span class="settings-info-label">Ngày cập nhật</span>
              <span class="settings-info-value">20/12/2025</span>
            </div>
          </div>

          <div class="settings-info-card mt-3">
            <div class="settings-info-header">
              <i class="bi bi-heart-fill text-danger"></i>
              <h6>Hỗ Trợ</h6>
            </div>
            <p class="settings-info-text">
              Cảm ơn bạn đã sử dụng ứng dụng! Nếu bạn gặp vấn đề hoặc có đề xuất, vui lòng liên hệ với chúng tôi.
            </p>
            <button class="btn btn-outline-light w-100"
              onclick="window.open('https://github.com/polo33333/ban_pick', '_blank')">
              <i class="bi bi-github me-2"></i>GitHub Repository
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- <div id="player-status" class="text-center" role="alert"></div> -->

    <div id="first-pick-status" class="text-center" style="font-weight: bold; color: white;"></div>

    <!-- Pre-Draft Selection View -->
    <div id="pre-draft-selection-view" style="display: none;"></div>

    <div id="teams-container" class="row align-items-start"></div>
  </div>
  <!-- Chat Widget -->
  <div id="chat-widget" class="chat-widget" style="display: none;">
    <div class="chat-header" id="chat-header">
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-chat-dots-fill"></i>
        <span>Trò chuyện</span>
      </div>
      <button class="btn btn-sm text-white p-0" id="chat-close-btn">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="chat-body" id="chat-body">
      <!-- Messages will be appended here -->
    </div>
    <div class="chat-footer">
      <input type="text" id="chat-input" class="chat-input" placeholder="Nhập tin nhắn..." autocomplete="off">
      <button id="chat-send-btn" class="chat-send-btn">
        <i class="bi bi-send-fill"></i>
      </button>
    </div>
  </div>

  <button id="chat-toggle-btn" class="chat-toggle-btn" style="display: none;">
    <i class="bi bi-chat-dots-fill"></i>
    <span class="chat-notification-badge" id="chat-notification-badge" style="display: none;">0</span>
  </button>

  <!-- Developer Credit Footer -->
  <div id="developer-footer" class="position-fixed bottom-0 start-0 w-100 text-center pb-3" style="z-index: 1000;">
    <div class="text-white-50" style="font-size: 0.75rem;">
      Development by <strong style="color: rgba(255, 255, 255, 0.9);">KDONE</strong>
    </div>
    <div class="text-center text-white-50" style="font-size: 0.8rem;">
      Version 1.2.1
    </div>
  </div>

  </div>
  <script src="/js/lib/bootstrap.bundle.min.js"></script>
  <script type="module" src="/js/app.js"></script>
</body>

</html>